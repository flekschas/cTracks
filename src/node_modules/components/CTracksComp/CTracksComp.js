import React from 'react'
import hamradio from 'hamradio'
import axios from 'axios'

import HiglassUI from './HiglassUI'
import CNVTable from './CNVTable'
import ChromView from './ChromView'
import TracksMenu from './TracksMenu'
import ServerAdd from './ServerAdd'
import RegisterURL from './RegisterURL'


import './CTracksComp.css'


class CTracksComp extends React.Component {
  constructor (props) {
    super(props);

    this.subscriptions = this.makeSubscriptions()
  }

  componentWillUnmount() {
    this.subscriptions.forEach(sub => sub.unsubscribe())
  }

  makeSubscriptions() {
    return [
      hamradio.subscribe(
        'registerURL',
        (name, {server, ...data}) => {
          axios.post(`${server}/register_url/`, data).then(response => {
            hamradio.publish('server/updated', server)
          })
        }
      )
    ]
  }

  render() {
    return (
      <div className = "TopContainer">

        <div className="LeftPanel">
          <div className="Box">
            <label>Higlass - Zoom to Chromosome</label>
            <ChromView chromInfo = {this.props.chromInfo} />
          </div>
          <div className="Box">
            <ServerAdd/>
          </div>
          <div className="Box">
            <RegisterURL/>
          </div>
          <div className="Box">
            <TracksMenu/>
          </div>

        </div>

        <div className = "RightPanel">
          <div className = "RightBox">
            <HiglassUI
              uid = {this.props.uid}
              chromInfo = {this.props.chromInfo}
            />
          </div>
          <CNVTable />
        </div>

      </div>
    )
  }
}

export default CTracksComp;
